<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="./src/output.css" />
  </head>
  <body>
    <div class="container mx-auto px-4 py-8">
      <!-- Header -->
      <div class="text-center mb-8">
        <h1 class="text-5xl font-bold text-slate-700 mb-2">
          üö∞ Galon Management System
        </h1>
        <p class="text-white text-lg opacity-90">
          Manage your water gallon business with ease
        </p>
      </div>

      <!-- Alert -->
      <div id="alert" class="mb-6"></div>

      <!-- Tabs -->
      <div class="flex gap-2 mb-0">
        <button
          onclick="switchTab('products')"
          class="tab-btn flex-1 bg-white text-purple-600 font-bold py-4 px-6 rounded-t-2xl shadow-lg hover:bg-gray-50 transition-all active-tab"
        >
          üì¶ Products
        </button>
        <button
          onclick="switchTab('transactions')"
          class="tab-btn flex-1 bg-white/80 text-gray-700 font-bold py-4 px-6 rounded-t-2xl hover:bg-white transition-all"
        >
          üí∞ Transactions
        </button>
      </div>

      <!-- Content Card -->
      <div class="bg-white rounded-b-2xl rounded-tr-2xl shadow-2xl p-8">
        <!-- Products Section -->
        <div id="products" class="section">
          <h2 class="text-3xl font-bold text-gray-800 mb-6">Manage Products</h2>

          <form
            id="productForm"
            onsubmit="saveProduct(event)"
            class="bg-slate-100 p-6 rounded-xl mb-8 border-2 border-blue-200"
          >
            <input type="hidden" id="productId" />

            <div class="grid md:grid-cols-2 gap-6 mb-6">
              <div>
                <label class="block text-gray-700 font-semibold mb-2"
                  >Galon Name</label
                >
                <input
                  type="text"
                  id="productName"
                  required
                  placeholder="e.g., Aqua 19L"
                  class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-purple-500 transition-all"
                />
              </div>
              <div>
                <label class="block text-gray-700 font-semibold mb-2"
                  >Price (Rp)</label
                >
                <input
                  type="number"
                  id="productPrice"
                  required
                  placeholder="e.g., 20000"
                  step="0.01"
                  class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-purple-500 transition-all"
                />
              </div>
            </div>

            <div class="flex gap-3">
              <button
                type="submit"
                id="productSubmitBtn"
                class="bg-gradient-to-r from-blue-500 to-purple-600 text-white font-bold py-3 px-8 rounded-lg hover:from-blue-600 hover:to-purple-700 transform hover:scale-105 transition-all shadow-lg"
              >
                ‚ûï Add Product
              </button>
              <button
                type="button"
                onclick="resetProductForm()"
                class="bg-gray-400 text-white font-bold py-3 px-8 rounded-lg hover:bg-gray-500 transition-all"
              >
                ‚ùå Cancel
              </button>
            </div>
          </form>

          <!-- Products Table -->
          <div class="overflow-x-auto rounded-xl border-2 border-gray-200">
            <table class="w-full">
              <thead
                class="bg-gradient-to-r from-blue-500 to-purple-600 text-white"
              >
                <tr>
                  <th class="px-6 py-4 text-left font-bold">ID</th>
                  <th class="px-6 py-4 text-left font-bold">Name</th>
                  <th class="px-6 py-4 text-left font-bold">Price (Rp)</th>
                  <th class="px-6 py-4 text-left font-bold">Actions</th>
                </tr>
              </thead>
              <tbody
                id="productsTable"
                class="divide-y divide-gray-200"
              ></tbody>
            </table>
          </div>
        </div>

        <!-- Transactions Section -->
        <div id="transactions" class="section hidden">
          <h2 class="text-3xl font-bold text-gray-800 mb-6">
            Manage Transactions
          </h2>

          <!-- Total Revenue Box -->
          <div
            class="bg-gradient-to-r from-green-400 to-blue-500 text-white p-8 rounded-2xl mb-8 shadow-xl"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-xl opacity-90 mb-2">üíµ Total Revenue</p>
                <p class="text-5xl font-bold" id="totalRevenue">Rp 0</p>
              </div>
              <div class="text-8xl opacity-20">üìä</div>
            </div>
          </div>

          <form
            id="transactionForm"
            onsubmit="saveTransaction(event)"
            class="bg-gradient-to-r from-green-50 to-blue-50 p-6 rounded-xl mb-8 border-2 border-green-200"
          >
            <input type="hidden" id="transactionId" />

            <div class="grid md:grid-cols-2 gap-6 mb-6">
              <div>
                <label class="block text-gray-700 font-semibold mb-2"
                  >Select Product</label
                >
                <select
                  id="transactionProduct"
                  required
                  class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-purple-500 transition-all"
                >
                  <option value="">-- Select Product --</option>
                </select>
              </div>
              <div>
                <label class="block text-gray-700 font-semibold mb-2"
                  >Quantity</label
                >
                <input
                  type="number"
                  id="transactionQuantity"
                  required
                  placeholder="e.g., 5"
                  min="1"
                  class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-purple-500 transition-all"
                />
              </div>
            </div>

            <div class="flex gap-3">
              <button
                type="submit"
                id="transactionSubmitBtn"
                class="bg-gradient-to-r from-green-500 to-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:from-green-600 hover:to-blue-700 transform hover:scale-105 transition-all shadow-lg"
              >
                ‚ûï Add Transaction
              </button>
              <button
                type="button"
                onclick="resetTransactionForm()"
                class="bg-gray-400 text-white font-bold py-3 px-8 rounded-lg hover:bg-gray-500 transition-all"
              >
                ‚ùå Cancel
              </button>
            </div>
          </form>

          <!-- Transactions Table -->
          <div class="overflow-x-auto rounded-xl border-2 border-gray-200">
            <table class="w-full">
              <thead
                class="bg-gradient-to-r from-green-500 to-blue-600 text-white"
              >
                <tr>
                  <th class="px-6 py-4 text-left font-bold">ID</th>
                  <th class="px-6 py-4 text-left font-bold">Product</th>
                  <th class="px-6 py-4 text-left font-bold">Quantity</th>
                  <th class="px-6 py-4 text-left font-bold">Price</th>
                  <th class="px-6 py-4 text-left font-bold">Total</th>
                  <th class="px-6 py-4 text-left font-bold">Actions</th>
                </tr>
              </thead>
              <tbody
                id="transactionsTable"
                class="divide-y divide-gray-200"
              ></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <script>
      const API_URL = "http://localhost/restapi/api.php";

      function switchTab(tab) {
        document.querySelectorAll(".tab-btn").forEach((btn) => {
          btn.classList.remove("active-tab", "bg-white", "text-purple-600");
          btn.classList.add("bg-white/80", "text-gray-700");
        });
        document.querySelectorAll(".section").forEach((section) => {
          section.classList.add("hidden");
        });

        event.target.classList.add("active-tab", "bg-white", "text-purple-600");
        event.target.classList.remove("bg-white/80", "text-gray-700");
        document.getElementById(tab).classList.remove("hidden");

        if (tab === "products") {
          loadProducts();
        } else {
          loadTransactions();
          loadProductsForSelect();
        }
      }

      // Show alert message
      function showAlert(message, type = "success") {
        const alertDiv = document.getElementById("alert");
        const bgColor =
          type === "success"
            ? "bg-green-100 border-green-400 text-green-700"
            : "bg-red-100 border-red-400 text-red-700";
        alertDiv.innerHTML = `
                <div class="${bgColor} border-2 px-6 py-4 rounded-xl font-semibold shadow-lg animate-pulse">
                    ${type === "success" ? "‚úÖ" : "‚ùå"} ${message}
                </div>
            `;
        setTimeout(() => (alertDiv.innerHTML = ""), 3000);
      }

      // ========== PRODUCTS ==========
      async function loadProducts() {
        try {
          const res = await fetch(`${API_URL}?endpoint=products`);
          const products = await res.json();
          const tbody = document.getElementById("productsTable");

          if (products.length === 0) {
            tbody.innerHTML =
              '<tr><td colspan="4" class="px-6 py-8 text-center text-gray-500">No products found</td></tr>';
            return;
          }

          tbody.innerHTML = products
            .map(
              (p, i) => `
                    <tr class="hover:bg-blue-50 transition-all ${
                      i % 2 === 0 ? "bg-gray-50" : "bg-white"
                    }">
                        <td class="px-6 py-4 font-semibold text-gray-700">${
                          p.id
                        }</td>
                        <td class="px-6 py-4 font-medium text-gray-800">${
                          p.name
                        }</td>
                        <td class="px-6 py-4 text-green-600 font-bold">Rp ${parseFloat(
                          p.price
                        ).toLocaleString("id-ID")}</td>
                        <td class="px-6 py-4">
                            <button onclick="editProduct(${
                              p.id
                            })" class="bg-yellow-500 text-white px-4 py-2 rounded-lg hover:bg-yellow-600 transition-all mr-2 font-semibold">
                                ‚úèÔ∏è Edit
                            </button>
                            <button onclick="deleteProduct(${
                              p.id
                            })" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-all font-semibold">
                                üóëÔ∏è Delete
                            </button>
                        </td>
                    </tr>
                `
            )
            .join("");
        } catch (err) {
         console.log(err);
          showAlert("failed to load products", "error");
        }
      }

      // add products function to send
      async function saveProduct(e) {
        e.preventDefault();

        const id = document.getElementById("productId").value;
        const name = document.getElementById("productName").value;
        const price = document.getElementById("productPrice").value;

        try {
          const url = id
            ? `${API_URL}?endpoint=products&id=${id}`
            : `${API_URL}?endpoint=products`;

          //  using post or put method as URL by ternary operator
          const method = id ? "PUT" : "POST";

          //fetching data using json API control in js method to php method encode
          const res = await fetch(url, {
            method: method,
            headers: { "Content-Type": "application/json" },

            // remind : this is the data went through out
            body: JSON.stringify({
              name, // name of the products
              price, // price of the products
            }),
          });

          //  waiting response from method PHP to send what the data is send or not
          const data = await res.json();

          //  triggering the php file to send the response data json message using json
          showAlert(data.message);

          //  function for clearing the form
          resetProductForm();

          //  function to reload the product that have been added after execute
          loadProducts();
        } catch (err) {
          showAlert("Failed to save product", "error");
        }
      }

      // edit products
      async function editProduct(id) {
        try {
          const res = await fetch(`${API_URL}?endpoint=products&id=${id}`);
          const product = await res.json();

          document.getElementById("productId").value = product.id;
          document.getElementById("productName").value = product.name;
          document.getElementById("productPrice").value = product.price;
          document.getElementById("productSubmitBtn").innerHTML =
            "üíæ Update Product";
          window.scrollTo(0, 0);
        } catch (err) {
          showAlert("Failed to load product", "error");
        }
      }

      // delete products
      async function deleteProduct(id) {
        // loop for asking the data will deleted, while cancel while returning the data
        if (!confirm("Are you sure you want to delete this product?")) return;

        // the logic for deleting the data using the ID to sent it to PHP method
        try {
          const res = await fetch(`${API_URL}?endpoint=products&id=${id}`, {
            // method in php will trigger this
            method: "DELETE",
          });
          //  same function like before
          const data = await res.json();
          showAlert(data.message);
          loadProducts();
        } catch (err) {
          // this allert will appear if the data unable to delete due error or something wrong
          showAlert("Failed to delete product", "error");
        }
      }

      // reset products form
      function resetProductForm() {
        document.getElementById("productForm").reset();
        document.getElementById("productId").value = "";
        document.getElementById("productSubmitBtn").innerHTML =
          "‚ûï Add Product";
      }

      // ========== TRANSACTIONS ==========
      async function loadProductsForSelect() {
        try {
          const res = await fetch(`${API_URL}?endpoint=products`);
          const products = await res.json();
          const select = document.getElementById("transactionProduct");

          select.innerHTML =
            '<option value="">-- Select Product --</option>' +
            products
              .map(
                (p) =>
                  `<option value="${p.id}">${p.name} - Rp ${parseFloat(
                    p.price
                  ).toLocaleString("id-ID")}</option>`
              )
              .join("");
        } catch (err) {
          showAlert("Failed to load products", "error");
        }
      }

      async function loadTransactions() {
        try {
          const res = await fetch(`${API_URL}?endpoint=transactions`);
          const transactions = await res.json();
          const tbody = document.getElementById("transactionsTable");

          if (transactions.length === 0) {
            tbody.innerHTML =
              '<tr><td colspan="6" class="px-6 py-8 text-center text-gray-500">No transactions found</td></tr>';
            document.getElementById("totalRevenue").textContent = "Rp 0";
            return;
          }

          let totalRevenue = 0;
          tbody.innerHTML = transactions
            .map((t, i) => {
              const total = t.quantity * parseFloat(t.product_price || 0);
              totalRevenue += total;
              return `
                        <tr class="hover:bg-green-50 transition-all ${
                          i % 2 === 0 ? "bg-gray-50" : "bg-white"
                        }">
                            <td class="px-6 py-4 font-semibold text-gray-700">${
                              t.id
                            }</td>
                            <td class="px-6 py-4 font-medium text-gray-800">${
                              t.product_name || "N/A"
                            }</td>
                            <td class="px-6 py-4 text-blue-600 font-bold">${
                              t.quantity
                            }x</td>
                            <td class="px-6 py-4 text-gray-600">Rp ${parseFloat(
                              t.product_price || 0
                            ).toLocaleString("id-ID")}</td>
                            <td class="px-6 py-4 text-green-600 font-bold text-lg">Rp ${total.toLocaleString(
                              "id-ID"
                            )}</td>
                            <td class="px-6 py-4">
                                <button onclick="editTransaction(${
                                  t.id
                                })" class="bg-yellow-500 text-white px-4 py-2 rounded-lg hover:bg-yellow-600 transition-all mr-2 font-semibold">
                                    ‚úèÔ∏è Edit
                                </button>
                                <button onclick="deleteTransaction(${
                                  t.id
                                })" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-all font-semibold">
                                    üóëÔ∏è Delete
                                </button>
                            </td>
                        </tr>
                    `;
            })
            .join("");

          document.getElementById(
            "totalRevenue"
          ).textContent = `Rp ${totalRevenue.toLocaleString("id-ID")}`;
        } catch (err) {
          showAlert("Failed to load transactions", "error");
        }
      }

      async function saveTransaction(e) {
        e.preventDefault();
        const id = document.getElementById("transactionId").value;
        const product_id = document.getElementById("transactionProduct").value;
        const quantity = document.getElementById("transactionQuantity").value;

        try {
          const url = id
            ? `${API_URL}?endpoint=transactions&id=${id}`
            : `${API_URL}?endpoint=transactions`;
          const method = id ? "PUT" : "POST";

          const res = await fetch(url, {
            method: method,
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ product_id, quantity }),
          });

          const data = await res.json();
          showAlert(data.message);
          resetTransactionForm();
          loadTransactions();
        } catch (err) {
          showAlert("Failed to save transaction", "error");
        }
      }

      async function editTransaction(id) {
        try {
          const res = await fetch(`${API_URL}?endpoint=transactions&id=${id}`);
          const transaction = await res.json();

          document.getElementById("transactionId").value = transaction.id;
          document.getElementById("transactionProduct").value =
            transaction.product_id;
          document.getElementById("transactionQuantity").value =
            transaction.quantity;
          document.getElementById("transactionSubmitBtn").innerHTML =
            "üíæ Update Transaction";
          window.scrollTo(0, 0);
        } catch (err) {
          showAlert("Failed to load transaction", "error");
        }
      }

      async function deleteTransaction(id) {
        if (!confirm("Are you sure you want to delete this transaction?"))
          return;

        try {
          const res = await fetch(`${API_URL}?endpoint=transactions&id=${id}`, {
            method: "DELETE",
          });
          const data = await res.json();
          showAlert(data.message);
          loadTransactions();
        } catch (err) {
          showAlert("Failed to delete transaction", "error");
        }
      }

      function resetTransactionForm() {
        document.getElementById("transactionForm").reset();
        document.getElementById("transactionId").value = "";
        document.getElementById("transactionSubmitBtn").innerHTML =
          "‚ûï Add Transaction";
      }

      // Load initial data
      loadProducts();
    </script>
  </body>
</html>
